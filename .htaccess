# Configuración del Sistema de Tutorías UNSAAC
Options -Indexes -MultiViews
DirectoryIndex frontend/index.html

<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /Sistema-de-tutorias/

  # ============================================
  # BACKEND API - Rutas sin extensión .php
  # ============================================
  
  # Bloquear acceso directo a archivos PHP del backend
  RewriteCond %{REQUEST_URI} backend/.*\.php$
  RewriteCond %{REQUEST_URI} !backend/routes\.php$
  RewriteRule .* - [F,L]
  
  # Todas las rutas /api/* van al enrutador routes.php
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^api/(.*)$ backend/routes.php [L,QSA]

  # Permitir acceso directo a archivos estáticos del backend
  RewriteRule ^backend/(storage|vendor)/(.*)$ backend/$1/$2 [L,NC]

  # ============================================
  # FRONTEND - Rutas limpias sin .html
  # ============================================
  
  # Recursos estáticos (CSS, JS, imágenes, componentes) - Reescribir rutas
  # IMPORTANTE: Estas reglas deben ir ANTES de cualquier otra regla
  # La bandera [L] hace que sean las ÚLTIMAS reglas aplicadas
  RewriteRule ^js/(.*)$ frontend/js/$1 [L,NC,END]
  RewriteRule ^css/(.*)$ frontend/css/$1 [L,NC,END]
  RewriteRule ^assets/(.*)$ frontend/assets/$1 [L,NC,END]
  RewriteRule ^components/(.*)$ frontend/components/$1 [L,NC,END]
  
  # Permitir acceso directo a archivos estáticos existentes
  RewriteCond %{REQUEST_FILENAME} -f
  RewriteRule ^ - [L]

  # Raíz del sitio
  RewriteRule ^$ frontend/index.html [L]

  # Páginas principales sin extensión
  RewriteRule ^login/?$ frontend/login.html [L,NC]
  RewriteRule ^verify/?$ frontend/verify.html [L,NC]
  RewriteRule ^panel/?$ frontend/panel.html [L,NC]
  RewriteRule ^semestre/?$ frontend/semestre.html [L,NC]
  RewriteRule ^panel/semestre/?$ frontend/semestre.html [L,NC]
  RewriteRule ^dashboard/?$ frontend/panel.html [L,NC]
  RewriteRule ^index/?$ frontend/index.html [L,NC]

  # Redirigir URLs con .html a versiones sin extensión
  # EXCEPTO para componentes, js, css y assets
  RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s([^.]+)\.html [NC]
  RewriteCond %{REQUEST_URI} !^/Sistema-de-tutorias/(components|js|css|assets)/ [NC]
  RewriteRule ^ %1 [R=301,L]

  # NO aplicar más reglas si es un archivo o directorio existente
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]
</IfModule>

# ============================================
# Seguridad
# ============================================
<FilesMatch "\.(env|md|sql)$">
  Order allow,deny
  Deny from all
</FilesMatch>
