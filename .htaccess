# Configuración del Sistema de Tutorías UNSAAC
Options -Indexes -MultiViews
DirectoryIndex frontend/index.html

<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /Sistema-de-tutorias/

  # ============================================
  # BACKEND API - Rutas sin extensión .php
  # ============================================
  
  # Bloquear acceso directo a archivos PHP del backend
  RewriteCond %{REQUEST_URI} backend/.*\.php$
  RewriteCond %{REQUEST_URI} !backend/routes\.php$
  RewriteCond %{REQUEST_URI} !backend/api/gestionUsuarios\.php$
  RewriteCond %{REQUEST_URI} !backend/api/asignacionTutor\.php$
  RewriteCond %{REQUEST_URI} !backend/api/semestre\.php$
  RewriteCond %{REQUEST_URI} !backend/api/atencionTutoria\.php$
  RewriteRule .* - [F,L]
  
  # Todas las rutas /api/* van al enrutador routes.php
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^api/(.*)$ backend/routes.php [L,QSA]

  # Permitir acceso directo a archivos estáticos del backend
  RewriteRule ^backend/(storage|vendor)/(.*)$ backend/$1/$2 [L,NC]

  # ============================================
  # FRONTEND - Rutas limpias sin .html
  # ============================================
  
  # ============================================
  # PÁGINAS Y MÓDULOS - DEBEN IR PRIMERO
  # ============================================
  
  # Raíz del sitio
  RewriteRule ^$ frontend/index.html [L]

  # Redirigir URLs con .html a versiones sin extensión (301 permanente)
  RewriteCond %{THE_REQUEST} \s/+Sistema-de-tutorias/(login|verify|panel|index)\.html[\s?] [NC]
  RewriteRule ^(.*)\.html$ /$1 [R=301,L]

  # Páginas principales sin extensión
  RewriteRule ^login/?$ frontend/login.html [L,NC]
  RewriteRule ^verify/?$ frontend/verify.html [L,NC]
  RewriteRule ^panel/?$ frontend/panel.html [L,NC,QSA]
  RewriteRule ^dashboard/?$ frontend/panel.html [L,NC,QSA]
  RewriteRule ^index/?$ frontend/index.html [L,NC]
  
  # Módulos que se cargan dentro del panel - Servir panel.html
  RewriteRule ^semestre/?$ frontend/panel.html [L,NC]
  RewriteRule ^gestion-usuarios/?$ frontend/panel.html [L,NC]
  RewriteRule ^asignaciones/?$ frontend/panel.html [L,NC]
  RewriteRule ^reportes/?$ frontend/panel.html [L,NC]
  RewriteRule ^historial/?$ frontend/panel.html [L,NC]
  RewriteRule ^auditoria/?$ frontend/panel.html [L,NC]
  
  # Módulo del Tutor
  RewriteRule ^tutor/?$ frontend/panel.html [L,NC]
  RewriteRule ^asignacionTutor/?$ frontend/panel.html [L,NC]

  # ============================================
  # RECURSOS ESTÁTICOS
  # ============================================
  
  # Recursos estáticos (CSS, JS, imágenes, componentes)
  RewriteRule ^js/(.*)$ frontend/js/$1 [L,NC]
  RewriteRule ^css/(.*)$ frontend/css/$1 [L,NC]
  RewriteRule ^assets/(.*)$ frontend/assets/$1 [L,NC]
  RewriteRule ^components/(.*)$ frontend/components/$1 [L,NC]
  
  # Permitir acceso directo a archivos estáticos existentes
  RewriteCond %{REQUEST_FILENAME} -f
  RewriteRule ^ - [L]
</IfModule>

# ============================================
# Control de Caché para JS y CSS
# ============================================
<IfModule mod_headers.c>
  # Deshabilitar caché para archivos JS y CSS
  <FilesMatch "\.(js|css)$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
  </FilesMatch>
</IfModule>

# ============================================
# Seguridad
# ============================================
<FilesMatch "\.(env|md|sql)$">
  Order allow,deny
  Deny from all
</FilesMatch>
