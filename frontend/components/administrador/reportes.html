<!-- ================================================
     REPORTES - Sistema de Tutorías UNSAAC
     ================================================ -->

<div class="reports-container">
    <h1 class="page-title">
        <i class="fa-solid fa-chart-line"></i>
        Reportes y Constancias
    </h1>

    <!-- Sección 1: Lista de Tutorados por Tutor -->
    <section class="report-section">
        <div class="section-header">
            <div class="section-title">
                <i class="fa-solid fa-users"></i>
                <h2>Lista de Tutorados por Tutor</h2>
            </div>
            <p class="section-description">
                Genera un documento PDF con la lista de todos los estudiantes asignados a un tutor específico para un semestre.
            </p>
        </div>

        <div class="report-controls">
            <div class="form-group">
                <label>
                    <i class="fa-solid fa-calendar"></i>
                    Seleccionar Semestre
                </label>
                <select id="semester-tutor-list" class="form-select">
                    <option value="">Cargando semestres...</option>
                </select>
            </div>

            <div class="form-group">
                <label>
                    <i class="fa-solid fa-chalkboard-user"></i>
                    Seleccionar Tutor
                </label>
                <select id="tutor-select" class="form-select" disabled>
                    <option value="">Primero selecciona un semestre</option>
                </select>
            </div>

            <button id="btn-generate-tutor-list" class="btn-generate">
                <i class="fa-solid fa-file-pdf"></i>
                Generar PDF
            </button>
        </div>
    </section>

    <!-- Sección 2: Constancia de Tutoría -->
    <section class="report-section">
        <div class="section-header">
            <div class="section-title">
                <i class="fa-solid fa-certificate"></i>
                <h2>Constancia de Tutoría</h2>
            </div>
            <p class="section-description">
                Busca si un estudiante tiene constancia generada y firmada. Ingresa el código del estudiante para verificar.
            </p>
        </div>

        <div class="report-controls">
            <div class="form-group">
                <label>
                    <i class="fa-solid fa-calendar"></i>
                    Seleccionar Semestre
                </label>
                <select id="semester-constancia" class="form-select">
                    <option value="">Cargando semestres...</option>
                </select>
            </div>

            <div class="form-group">
                <label>
                    <i class="fa-solid fa-user-graduate"></i>
                    Código del Estudiante
                </label>
                <div class="search-input-wrapper">
                    <input 
                        type="text" 
                        id="student-code-constancia" 
                        class="form-input"
                        placeholder="Ingrese el código del estudiante..."
                    >
                    <i class="fa-solid fa-magnifying-glass search-icon"></i>
                </div>
            </div>

            <button id="btn-search-constancia" class="btn-secondary" onclick="buscarConstanciaEstudiante()">
                <i class="fa-solid fa-search"></i>
                Buscar Constancia
            </button>
        </div>

        <!-- Resultado de búsqueda de constancia -->
        <div id="constancia-result" class="constancia-result hidden">
            <div class="result-card">
                <div class="result-header">
                    <h4 id="result-student-name"></h4>
                    <span id="result-student-code" class="code-badge"></span>
                </div>
                <div class="result-body">
                    <div class="constancia-status" id="constancia-status-container">
                        <!-- Se llenará dinámicamente -->
                    </div>
                </div>
            </div>
        </div>
                    <div class="info-item">
                        <span class="info-label">Estado:</span>
                        <span id="const-status" class="info-value"></span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Sección 4: Reporte de Cumplimiento -->
    <section class="report-section">
        <div class="section-header">
            <div class="section-title">
                <i class="fa-solid fa-chart-bar"></i>
                <h2>Reporte de Cumplimiento</h2>
            </div>
            <p class="section-description">
                Muestra un resumen estadístico de cuántos tutores han registrado sus sesiones y promedio de sesiones por estudiante.
            </p>
        </div>

        <div class="report-controls">
            <div class="form-group">
                <label>
                    <i class="fa-solid fa-calendar"></i>
                    Seleccionar Semestre
                </label>
                <select id="semester-compliance" class="form-select">
                    <option value="">Cargando semestres...</option>
                </select>
            </div>

            <button id="btn-generate-compliance" class="btn-generate">
                <i class="fa-solid fa-chart-simple"></i>
                Generar Gráfico
            </button>
        </div>

        <!-- Resultados del reporte -->
        <div id="compliance-results" class="compliance-results hidden">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fa-solid fa-chalkboard-user"></i>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">Total Tutores</span>
                        <span id="stat-total-tutors" class="stat-value">0</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fa-solid fa-user-graduate"></i>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">Total Estudiantes</span>
                        <span id="stat-total-students" class="stat-value">0</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fa-solid fa-calendar-check"></i>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">Sesiones Registradas</span>
                        <span id="stat-total-sessions" class="stat-value">0</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fa-solid fa-chart-line"></i>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">Promedio por Estudiante</span>
                        <span id="stat-avg-sessions" class="stat-value">0.0</span>
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="compliance-chart"></canvas>
            </div>
        </div>
    </section>
</div>

<!-- Modal para visualizar PDF -->
<div id="pdf-modal" class="pdf-modal" style="display: none;">
    <div class="pdf-modal-content">
        <div class="pdf-modal-header">
            <h3>
                <i class="fa-solid fa-file-pdf"></i>
                Vista Previa del Reporte
            </h3>
            <button class="pdf-modal-close" onclick="closePdfModal()">
                <i class="fa-solid fa-times"></i>
            </button>
        </div>
        <div class="pdf-modal-body">
            <div id="pdf-preview-content" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 40px; text-align: center;">
                <i class="fa-solid fa-check-circle" style="font-size: 64px; color: #27ae60; margin-bottom: 20px;"></i>
                <h3 style="color: #2c3e50; margin-bottom: 10px;">PDF Generado Exitosamente</h3>
                <p style="color: #7f8c8d; margin-bottom: 30px;">El reporte se ha generado correctamente. Puedes descargarlo o abrirlo en una nueva pestaña.</p>
                <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                    <button class="btn-download-pdf" onclick="downloadCurrentPdf()" style="padding: 12px 24px; font-size: 16px;">
                        <i class="fa-solid fa-download"></i>
                        Descargar PDF
                    </button>
                    <button class="btn-secondary" onclick="openPdfInNewTab()" style="padding: 12px 24px; font-size: 16px;">
                        <i class="fa-solid fa-external-link-alt"></i>
                        Abrir en Nueva Pestaña
                    </button>
                </div>
            </div>
        </div>
        <div class="pdf-modal-footer">
            <button class="btn-download-pdf" onclick="downloadCurrentPdf()">
                <i class="fa-solid fa-download"></i>
                Descargar PDF
            </button>
            <button class="btn-close-modal" onclick="closePdfModal()">
                <i class="fa-solid fa-times"></i>
                Cerrar
            </button>
        </div>
    </div>
</div>

<!-- Loading overlay -->
<div id="loading-overlay" class="loading-overlay" style="display: none;">
    <div class="loading-spinner">
        <i class="fa-solid fa-spinner fa-spin"></i>
        <p>Procesando...</p>
    </div>
</div>
